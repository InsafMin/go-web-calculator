# üßÆ –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä

> –ü—Ä–æ–µ–∫—Ç: –≤–µ–±-–∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å JWT-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π, SQLite-–ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é –∏ gRPC-–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ–º –º–µ–∂–¥—É –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –∏ –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª–µ–º (worker).

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

1. ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ JWT
2. ‚úÖ –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π
3. ‚úÖ –•—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–π –≤ **SQLite**
4. ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
5. ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
6. ‚úÖ gRPC –≤–º–µ—Å—Ç–æ HTTP –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ (–¥–æ —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è HTTP)
7. ‚úÖ –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:
   - –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏
   - Worker'—ã –ø–æ–ª—É—á–∞—é—Ç –∑–∞–¥–∞—á–∏ –∏–∑ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
8. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ:
   - Orchestrator –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º
   - Worker'—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –∏ –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –∫ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä—É

---

## üìå –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
go-web-calculator/
‚îú‚îÄ‚îÄ go.mod
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ .dockerignore
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îú‚îÄ‚îÄ calc_service/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.go       ‚Üê —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
‚îÇ   ‚îî‚îÄ‚îÄ worker/
‚îÇ       ‚îî‚îÄ‚îÄ main.go       ‚Üê —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ worker'–∞
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ orchestrator/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ server/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ jwt.go           ‚Üê jwt —Ç–æ–∫–µ–Ω—ã
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ middleware.go    ‚Üê –º–∏–¥–ª–≤–µ–π—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ user.go          ‚Üê —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–ª–æ–≥–∏–Ω
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ calculate.go     ‚Üê –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã—Ä–∞–∂–µ–Ω–∏—è
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ expressions.go   ‚Üê –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–π
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ task.go          ‚Üê —Ä–∞–±–æ—Ç–∞ —Å –∑–∞–¥–∞—á–∞–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ agent/
‚îÇ       ‚îî‚îÄ‚îÄ worker/
‚îÇ           ‚îî‚îÄ‚îÄ worker.go         ‚Üê –ª–æ–≥–∏–∫–∞ worker'–∞
‚îú‚îÄ‚îÄ pkg/
‚îÇ   ‚îú‚îÄ‚îÄ calculator/               ‚Üê –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ types/                    ‚Üê —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ errors/errors.go          ‚Üê –æ—à–∏–±–∫–∏
‚îú‚îÄ‚îÄ proto/
‚îÇ   ‚îî‚îÄ‚îÄ task.proto                ‚Üê gRPC —Å–µ—Ä–≤–∏—Å
‚îî‚îÄ‚îÄ migrations/
    ‚îî‚îÄ‚îÄ init.sql                  ‚Üê –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
```

---

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç

### 1. –ö–ª–æ–Ω–∏—Ä—É–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:

```bash
git clone https://github.com/InsafMin/go-web-calculator.git
cd go-web-calculator
```

### 2. –£–±–µ–¥–∏—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:

- Go 1.23+
- Docker & Docker Compose
- curl –∏–ª–∏ Postman –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 3.1 –ó–∞–ø—É—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å/—Ç–µ—Ä–º–∏–Ω–∞–ª:

- –ü–µ—Ä–≤–æ–µ –æ–∫–Ω–æ
```bash
go run ./cmd/calc_service/
```
- –í—Ç–æ—Ä–æ–µ –æ–∫–Ω–æ
```bash
go run ./cmd/worker/
```

### 3.2 –ò–ª–∏ –∑–∞–ø—É—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç —á–µ—Ä–µ–∑ Docker Compose:

```bash
docker-compose up --build
```

‚Üí –≠—Ç–æ —Å–æ–±–µ—Ä—ë—Ç –∏ –∑–∞–ø—É—Å—Ç–∏—Ç:
- –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –Ω–∞ –ø–æ—Ä—Ç—É `8080`
- Worker'–æ–≤
- –ë–∞–∑—É –¥–∞–Ω–Ω—ã—Ö SQLite (`calc.db`)

---

## üîê –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```bash
curl -X POST http://localhost:8080/api/v1/register \
     -H "Content-Type: application/json" \
     -d '{"login": "user1", "password": "pass1"}'
```

**–û—Ç–≤–µ—Ç:**
```json
{"message": "OK"}
```

---

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–ø–æ–ª—É—á–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞)

```bash
curl -X POST http://localhost:8080/api/v1/login \
     -H "Content-Type: application/json" \
     -d '{"login": "user1", "password": "pass1"}'
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.xxxxx"
}
```

---

## üß™ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API

### –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ

```bash
curl -X POST http://localhost:8080/api/v1/calculate \
     -H "Authorization: Bearer <your_token>" \
     -H "Content-Type: application/json" \
     -d '{"expression": "2+2*2"}'
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": "1234567890"
}
```

---

### –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```bash
curl -X GET http://localhost:8080/api/v1/expressions \
     -H "Authorization: Bearer <your_token>"
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "expressions": [
    {
      "id": "1234567890",
      "expression": "2+2*2",
      "status": "done",
      "result": 6
    }
  ]
}
```

---

### –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –ø–æ ID

```bash
curl -X GET http://localhost:8080/api/v1/expressions/1234567890 \
     -H "Authorization: Bearer <your_token>"
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "expression": {
    "id": "1234567890",
    "expression": "2+2*2",
    "status": "done",
    "result": 6
  }
}
```

---

## üß± –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö —á–∞—Å—Ç–µ–π:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| **Orchestrator** | –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä, –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Ö—Ä–∞–Ω–∏—Ç –∑–∞–¥–∞—á–∏ –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç worker'–∞–º–∏ |
| **Worker** | –í—ã—á–∏—Å–ª—è–µ—Ç –≤—ã—Ä–∞–∂–µ–Ω–∏—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞—Ç–Ω–æ |
| **gRPC** | –û–±—â–µ–Ω–∏–µ –º–µ–∂–¥—É –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –∏ worker'–∞–º–∏ (–∑–∞–º–µ–Ω—è–µ—Ç HTTP) |
| **SQLite** | –•—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–π –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |

---

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- ‚úÖ Golang
- ‚úÖ REST API
- ‚úÖ JWT –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚úÖ SQLite –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ gRPC –¥–ª—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- ‚úÖ Docker + Docker Compose –¥–ª—è —Ä–∞–∑–≤—ë—Ä—Ç–∫–∏

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:

```bash
sqlite3 calc.db
SELECT * FROM expressions;
```

‚Üí –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—ã—Ä–∞–∂–µ–Ω–∏—è, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ä–∞–∑–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏.

---

## üì¶ Docker Compose

–°–æ–¥–µ—Ä–∂–∏—Ç:

- `orchestrator` ‚Üí `cmd/calc_service/main.go`
- `worker1`, `worker2` ‚Üí `cmd/worker/main.go`

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `./calc.db`
- –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è

---

## üß™ –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ

| –û—à–∏–±–∫–∞ | –ß—Ç–æ –¥–µ–ª–∞—Ç—å |
|--------|-------------|
| ‚ùå `no tasks available` | –ü—Ä–æ–≤–µ—Ä—å, –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ —Ä–∞–∑–±–∏—Ç–æ –Ω–∞ –∑–∞–¥–∞—á–∏ |
| ‚ùå `unauthorized` | –£–±–µ–¥–∏—Å—å, —á—Ç–æ —Ç–æ–∫–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω –∏ –ø–µ—Ä–µ–¥–∞–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ |
| ‚ùå `division by zero` | –û—Ç–ø—Ä–∞–≤—å –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –±–µ–∑ –¥–µ–ª–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å üòÑ |
| ‚ùå `expression not found` | –ü—Ä–æ–≤–µ—Ä—å, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –≤ –±–∞–∑–µ |

---

## üß™ –õ–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

```bash
docker logs go-web-calculator-orchestrator-1
docker logs go-web-calculator-worker1-1
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit-—Ç–µ—Å—Ç—ã

```bash
go test ./pkg/calculator/
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

```bash
go test ./internal/orchestrator/handlers/
```

---

## üß™ –ü—Ä–∏–º–µ—Ä —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞

```
Starting orchestrator on :8080
Worker started
Got task: ID=1747143071, Expr="2+2*2"
Task finished successfully: ...
Sent result for 1747143071: 6.0
```

---

## üß™ –§–æ—Ä–º–∞—Ç JSON –æ—Ç–≤–µ—Ç–∞

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|-----------|
| `id` | string | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –≤—ã—Ä–∞–∂–µ–Ω–∏—è |
| `expression` | string | –ò—Å—Ö–æ–¥–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ |
| `status` | string | `pending`, `in_progress`, `done`, `error` |
| `result` | float64 –∏–ª–∏ null | –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã—á–∏—Å–ª–µ–Ω–∏—è |
| `error` | string –∏–ª–∏ null | –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ (–µ—Å–ª–∏ –µ—Å—Ç—å) |

---

## ‚úÖ –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—é—â–∏–π –¥–æ–ª–∂–µ–Ω —É–≤–∏–¥–µ—Ç—å:

| –ü—É–Ω–∫—Ç | –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ |
|------|---------------------------|
| 1 | ‚úÖ –†–∞–±–æ—Ç–∞ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| 2 | ‚úÖ –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ SQLite, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ |
| 3 | ‚úÖ gRPC –≤–º–µ—Å—Ç–æ HTTP –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ |
| 4 | ‚úÖ Unit-—Ç–µ—Å—Ç—ã |
| 5 | ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã |
| 6 | ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Readme –∏ –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ |
| 7 | ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π `docker-compose up --build` |

---

## üß¨ –ê–≤—Ç–æ—Ä

GitHub: [https://github.com/InsafMin/go-web-calculator](https://github.com/InsafMin/go-web-calculator)  
Email: insaf.min.in@yandex.ru